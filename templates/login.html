{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - POTMPC</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" />
    <link rel="stylesheet" href="{% static 'css/login_custom.css' %}" />
</head>
<body>
    <!-- Carousel Background -->
    <div class="carousel-background">
        <img src="{% static 'img/bg.jpg' %}" class="carousel-img active" alt="Background 1">
        <img src="{% static 'img/bg2.jpg' %}" class="carousel-img" alt="Background 2">
        <img src="{% static 'img/bg3.jpg' %}" class="carousel-img" alt="Background 3">
        <img src="{% static 'img/bg4.jpg' %}" class="carousel-img" alt="Background 4">
    </div>
    <div class="overlay"></div>
    
    <!-- Login Card -->
    <div class="auth-card login-card" id="loginCard">
        <div class="auth-header">
            <img src="{% static 'img/home.png' %}" class="auth-logo" onerror="this.style.display='none'">
            <h1 class="auth-title">Welcome</h1>
            <p class="auth-subtitle">Sign in to continue</p>
        </div>
        
        {% if messages %}
            <div class="mt-2">
                {% for message in messages %}
                    <div class="alert alert-danger text-center" role="alert">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Login Method Toggle -->
        <div class="login-method-toggle">
            <button type="button" class="method-btn active" data-method="credentials">
                <span class="method-icon">&#128100;</span>
                User Details
            </button>
            <button type="button" class="method-btn" data-method="qr">
                <span class="method-icon">&#128247;</span>
                QR Code
            </button>
        </div>

        <!-- Credentials Login Form -->
        <form method="post" class="auth-form" id="credentialsForm">
            {% csrf_token %}
            <div class="input-group">
                <span class="icon">&#128100;</span>
                <input type="text" name="username" placeholder="Username" required>
            </div>
            <div class="input-group">
                <span class="icon">&#128274;</span>
                <input type="password" name="password" placeholder="Password" id="password" required>
                <span class="toggle-password" onclick="togglePassword()">&#128065;</span>
            </div>
            <div class="options">
                <a href="{% url 'password_reset' %}" class="forgot-link">Forgot Password?</a>
            </div>
            <button type="submit" class="auth-btn">Sign In</button>
        </form>

        <!-- QR Login Content (Hidden by default) -->
        <div class="qr-login-content" id="qrLoginContent" style="display: none;">
            <p class="qr-instruction">Scan your QR code or upload an image</p>
            <a href="{% url 'qr_scan' %}" class="auth-btn qr-btn">
                <span class="method-icon">&#128247;</span>
                Open QR Scanner
            </a>
        </div>

        <!-- Register Link -->
        <div class="auth-footer">
            <p>Don't have an account?</p>
            <button type="button" class="link-btn" id="showRegisterBtn">Create Account</button>
        </div>
    </div>

    <!-- Register Card -->
    <div class="auth-card register-card" id="registerCard">
        <button type="button" class="back-btn" id="backToLoginBtn">
            <span>&#8592;</span>
        </button>
        
        <div class="auth-header">
            <img src="{% static 'img/home.png' %}" class="auth-logo" onerror="this.style.display='none'">
            <h1 class="auth-title">Create Account</h1>
            <p class="auth-subtitle">Register here</p>
        </div>

        <form method="post" action="{% url 'register' %}" enctype="multipart/form-data" class="auth-form register-form" id="registerForm">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label for="id_username">Username</label>
                    <input type="text" name="username" id="id_username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="id_full_name">Full Name</label>
                    <input type="text" name="full_name" id="id_full_name" class="form-control" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="id_email">Email</label>
                    <input type="email" name="email" id="id_email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="id_phone_number">Phone Number</label>
                    <input type="text" name="phone_number" id="id_phone_number" class="form-control" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="id_password1">Password</label>
                    <input type="password" name="password1" id="id_password1" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="id_password2">Confirm Password</label>
                    <input type="password" name="password2" id="id_password2" class="form-control" required>
                </div>
            </div>
            <div class="form-group">
                <label for="id_id_image">Valid ID (JPG/PNG)</label>
                <div class="file-upload-wrapper">
                    <input type="file" name="id_image" id="id_id_image" accept="image/*" required>
                    <label for="id_id_image" class="file-upload-label">
                        <span class="file-icon">&#128193;</span>
                        <span class="file-text">Choose File</span>
                    </label>
                </div>
                <img id="imgPreview" class="img-preview" alt="ID Preview" style="display: none;"/>
            </div>
            <button type="submit" class="auth-btn">Register</button>
        </form>

        <div class="auth-footer">
            <p>Already have an account?</p>
            <button type="button" class="link-btn" id="showLoginBtn">Sign In</button>
        </div>
    </div>
    <script>
        function togglePassword() {
            var pwd = document.getElementById('password');
            var toggleIcon = document.querySelector('.toggle-password');
            if (pwd.type === 'password') {
                pwd.type = 'text';
                toggleIcon.innerHTML = '&#128064;';
            } else {
                pwd.type = 'password';
                toggleIcon.innerHTML = '&#128065;';
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            // Carousel functionality
            const carouselImages = document.querySelectorAll('.carousel-img');
            let currentIndex = 0;

            function showNextImage() {
                carouselImages[currentIndex].classList.remove('active');
                currentIndex = (currentIndex + 1) % carouselImages.length;
                carouselImages[currentIndex].classList.add('active');
            }
            setInterval(showNextImage, 7000);

            // Login/Register card transitions
            const loginCard = document.getElementById('loginCard');
            const registerCard = document.getElementById('registerCard');
            const showRegisterBtn = document.getElementById('showRegisterBtn');
            const showLoginBtn = document.getElementById('showLoginBtn');
            const backToLoginBtn = document.getElementById('backToLoginBtn');

            showRegisterBtn.addEventListener('click', function() {
                loginCard.classList.add('slide-out-right');
                registerCard.classList.add('slide-in-left');
                setTimeout(() => {
                    loginCard.style.display = 'none';
                    registerCard.style.display = 'flex';
                }, 50);
            });

            function showLogin() {
                registerCard.classList.remove('slide-in-left');
                registerCard.classList.add('slide-out-left');
                loginCard.classList.remove('slide-out-right');
                loginCard.style.display = 'flex';
                loginCard.classList.add('slide-in-right');
                setTimeout(() => {
                    registerCard.style.display = 'none';
                }, 500);
            }

            showLoginBtn.addEventListener('click', showLogin);
            backToLoginBtn.addEventListener('click', showLogin);

            // Login method toggle
            const methodBtns = document.querySelectorAll('.method-btn');
            const credentialsForm = document.getElementById('credentialsForm');
            const qrLoginContent = document.getElementById('qrLoginContent');

            methodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    methodBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const method = this.getAttribute('data-method');
                    if (method === 'credentials') {
                        credentialsForm.style.display = 'block';
                        qrLoginContent.style.display = 'none';
                    } else {
                        credentialsForm.style.display = 'none';
                        qrLoginContent.style.display = 'block';
                    }
                });
            });

            // Image preview for registration
            const fileInput = document.getElementById('id_id_image');
            const imgPreview = document.getElementById('imgPreview');
            const fileLabel = document.querySelector('.file-upload-label .file-text');

            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    if (fileInput.files && fileInput.files[0]) {
                        const fileName = fileInput.files[0].name;
                        fileLabel.textContent = fileName;
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imgPreview.src = e.target.result;
                            imgPreview.style.display = 'block';
                        };
                        reader.readAsDataURL(fileInput.files[0]);
                    } else {
                        imgPreview.style.display = 'none';
                        fileLabel.textContent = 'Choose File';
                    }
                });
            }
        });
    </script>
</body>
</html>