{% extends 'user_base.html' %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/user_home_cards.css' %}">
{% endblock %}
{% block title %}User Home - POTMPC{% endblock %}
{% block content %}
<div class="container py-5">
  <div class="row mb-4 align-items-center">
    <div class="col-md-12">
      <h1 class="h3 mb-1">Welcome,
        {% if request.user.member_profile %}{{ request.user.username }}
        {% else %}{{ request.user.username }}{% endif %}
      </h1>
      <p class="text-muted">Quick access to your documents, announcements and profile.</p>
    </div>
  </div>

  <div class="user-card-grid">
    <a class="user-card" href="{% url 'user_documents' %}">
      <div class="uc-left">
        <div class="uc-icon uc-icon-docs"><i class="la la-file"></i></div>
      </div>
      <div class="uc-body">
        <div class="uc-title">My Documents</div>
        <div class="uc-sub" id="user-doc-count">Loading...</div>
      </div>
      <div class="uc-right">
        <span class="uc-action">Open</span>
      </div>
    </a>

    <a class="user-card" href="{% url 'user_announcements' %}">
      <div class="uc-left">
        <div class="uc-icon uc-icon-bell"><i class="la la-bell"></i></div>
      </div>
      <div class="uc-body">
        <div class="uc-title">Announcements</div>
        <div class="uc-sub">View messages from managers</div>
      </div>
      <div class="uc-right">
        <span class="uc-action">View</span>
      </div>
    </a>

    <a class="user-card" href="{% url 'user_profile' %}">
      <div class="uc-left">
        <div class="uc-icon uc-icon-user"><i class="la la-user"></i></div>
      </div>
      <div class="uc-body">
        <div class="uc-title">My Profile</div>
        <div class="uc-sub">Edit contact & profile picture</div>
      </div>
      <div class="uc-right">
        <span class="uc-action">Edit</span>
      </div>
    </a>

    <a class="user-card" href="{% url 'user_vehicles' %}">
      <div class="uc-left">
        <div class="uc-icon uc-icon-car"><i class="la la-car"></i></div>
      </div>
      <div class="uc-body">
        <div class="uc-title">My Vehicles</div>
        <div class="uc-sub">{{ vehicles_count|default:0 }} total</div>
      </div>
      <div class="uc-right">
        <span class="uc-action">Browse</span>
      </div>
    </a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  fetch("{% url 'user_document_entry_count_api' %}")
    .then(response => response.json())
    .then(data => {
      const count = data.count || 0;
      const plural = count === 1 ? "" : "s";
      document.getElementById("user-doc-count").textContent = `${count} document${plural}`;
    })
    .catch(() => {
      document.getElementById("user-doc-count").textContent = "0 documents";
    });
});
</script>
{% endblock %}
