{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
  <div class="card">
    <div class="card-header">
      <h4>Edit Account: {{ edited_user.username }}</h4>
    </div>
    <div class="card-body">
      <form method="post" action="{% url 'edit_account' edited_user.id %}">
        {% csrf_token %}
        <div class="form-group">
          <label for="full_name">Full Name</label>
          <input type="text" class="form-control" id="full_name" name="full_name" value="{{ edited_user.full_name }}">
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" class="form-control" id="email" name="email" value="{{ edited_user.email }}">
        </div>
        <div class="form-group">
          <label for="phone">Phone Number</label>
          <input type="text" class="form-control" id="phone" name="phone_number" value="{{ edited_user.phone_number }}">
        </div>
        <div class="form-group">
          <label for="memberSelect">Member</label>
          <select class="form-control" id="memberSelect" name="member_id" style="width:100%">
            {% if edited_user.member_profile %}
              <option value="{{ edited_user.member_profile.id }}" selected>{{ edited_user.member_profile.full_name }}</option>
            {% endif %}
          </select>
          <small class="form-text text-muted">
            Search and select a member to tie, or clear to untie.
          </small>
        </div>
        <div class="form-group mt-4">
          <button type="submit" class="btn btn-primary">Save changes</button>
          <a href="{% url 'accounts_list' %}" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Select2 and jQuery should be included in your base.html -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const $select = $('#memberSelect');

  if (!$select.length) {
    console.error("Select element not found");
    return;
  }

  $select.select2({
    theme: 'bootstrap-5',
    placeholder: "-- Unselect Member --",
    allowClear: true,
    ajax: {
      url: "{% url 'member_search_api' %}",
      dataType: 'json',
      delay: 250,
      data: params => ({ q: params.term }),
      processResults: data => ({ results: data.results }),
      cache: true
    },
    minimumInputLength: 1,
    width: 'resolve'
  });
});
</script>
{% endblock %}