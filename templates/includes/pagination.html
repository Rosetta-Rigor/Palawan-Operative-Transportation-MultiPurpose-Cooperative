{% if is_paginated %}
<nav aria-label="Pagination" class="d-flex flex-column flex-lg-row align-items-center justify-content-between">
  <ul class="pagination mb-2 mb-lg-0">
    <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
      <a class="page-link" href="?page=1{% if q %}&q={{ q|urlencode }}{% endif %}" data-page="1">First</a>
    </li>

    <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
      {% if page_obj.has_previous %}
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}" data-page="{{ page_obj.previous_page_number }}">Prev</a>
      {% else %}
        <span class="page-link">Prev</span>
      {% endif %}
    </li>

    {# numeric window with clickable ellipses #}
    {% for p in paginator.page_range %}
      {% if p == 1 or p == paginator.num_pages or p <= page_obj.number|add:'2' and p >= page_obj.number|add:'-2' %}
        {% if p == page_obj.number %}
          <li class="page-item active"><span class="page-link">{{ p }}</span></li>
        {% else %}
          <li class="page-item"><a class="page-link" href="?page={{ p }}{% if q %}&q={{ q|urlencode }}{% endif %}" data-page="{{ p }}">{{ p }}</a></li>
        {% endif %}
      {% elif p == 2 and page_obj.number > 4 %}
        {# if there is a big gap after the first pages, show jump-back ellipsis #}
        <li class="page-item"><a class="page-link" href="#" data-page="{{ page_obj.number|add:'-5' }}">…</a></li>
      {% elif p == paginator.num_pages|add:'-1' and page_obj.number < paginator.num_pages|add:'-3' %}
        {# if there is a big gap before the last pages, show jump-forward ellipsis #}
        <li class="page-item"><a class="page-link" href="#" data-page="{{ page_obj.number|add:'5' }}">…</a></li>
      {% endif %}
    {% endfor %}

    <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
      {% if page_obj.has_next %}
        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}" data-page="{{ page_obj.next_page_number }}">Next</a>
      {% else %}
        <span class="page-link">Next</span>
      {% endif %}
    </li>

    <li class="page-item {% if page_obj.number == paginator.num_pages %}disabled{% endif %}">
      <a class="page-link" href="?page={{ paginator.num_pages }}{% if q %}&q={{ q|urlencode }}{% endif %}" data-page="{{ paginator.num_pages }}">Last</a>
    </li>
  </ul>

  <div class="small text-muted">
    Showing <strong>{{ page_obj.start_index }}–{{ page_obj.end_index }}</strong> of <strong>{{ paginator.count }}</strong>
  </div>
</nav>
{% endif %}