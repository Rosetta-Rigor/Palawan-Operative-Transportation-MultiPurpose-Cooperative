{% extends 'base.html' %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/admin_forms.css' %}">
{% load widget_tweaks %}
{% block content %}
<div class="content admin-dashboard">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-8">
                <div class="admin-form-card">
                    <div class="form-header-gradient">
                        <h4 class="form-header-title">
                            <i class="fas fa-file-alt"></i> Add Document (TIN)
                        </h4>
                        <p class="form-header-sub">Register a new TIN document for a vehicle</p>
                    </div>
                    <div class="form-content">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            {% if form.non_field_errors %}
                                <div class="alert alert-danger">{{ form.non_field_errors }}</div>
                            {% endif %}
                            
                            <div class="form-group">
                                <label for="id_tin">TIN Number</label>
                                {{ form.tin|add_class:"form-control" }}
                                {% if form.tin.errors %}<div class="text-danger small">{{ form.tin.errors }}</div>{% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label for="id_vehicle">Vehicle</label>
                                <select id="id_vehicle" name="vehicle" class="form-control" style="width:100%">
                                    {% if selected_vehicle %}
                                        <option value="{{ selected_vehicle }}" selected="selected">{{ selected_vehicle }}</option>
                                    {% elif form.vehicle.value %}
                                        <option value="{{ form.vehicle.value }}" selected="selected">{{ form.vehicle.value }}</option>
                                    {% endif %}
                                </select>
                                {% if form.vehicle.errors %}<div class="text-danger small">{{ form.vehicle.errors }}</div>{% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label for="id_renewal_date">Renewal Date</label>
                                {{ entry_form.renewal_date|add_class:"form-control" }}
                                {% if entry_form.renewal_date.errors %}<div class="text-danger small">{{ entry_form.renewal_date.errors }}</div>{% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label for="id_official_receipt">Official Receipt (OR)</label>
                                <div class="custom-file-upload">
                                    {{ entry_form.official_receipt }}
                                </div>
                                {% if entry_form.official_receipt.errors %}<div class="text-danger small">{{ entry_form.official_receipt.errors }}</div>{% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label for="id_certificate_of_registration">Certificate of Registration (COR)</label>
                                <div class="custom-file-upload">
                                    {{ entry_form.certificate_of_registration }}
                                </div>
                                {% if entry_form.certificate_of_registration.errors %}<div class="text-danger small">{{ entry_form.certificate_of_registration.errors }}</div>{% endif %}
                            </div>
                            
                            <div class="form-actions">
                                <a href="{% url 'document_list' %}" class="btn btn-secondary">Cancel</a>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Create Document
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#id_vehicle').select2({
        theme: 'bootstrap-5',
        placeholder: "Search by member name or plate number...",
        allowClear: true,
        ajax: {
            url: "{% url 'vehicle_member_select2_api' %}",
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return { q: params.term };
            },
            processResults: function(data) {
                return { results: data.results };
            },
            cache: true
        },
        minimumInputLength: 1,
        width: 'resolve'
    });
});
</script>
{% endblock %}